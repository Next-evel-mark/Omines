<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YouTube Song Downloader</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 700px; margin:auto; background:#fafafa;}
    h1 { color:#111; }
    input, button, select { padding:10px; border-radius:6px; border:1px solid #ccc; margin:4px 0; }
    button { background:#007bff; color:#fff; border:none; cursor:pointer;}
    button:hover { background:#0056b3;}
    .result { display:flex; align-items:center; gap:10px; background:#fff; margin:6px 0; padding:8px; border-radius:8px; border:1px solid #eee;}
    img.thumb { width:100px; border-radius:6px; }
    .actions button { margin-left:4px; }
  </style>
</head>
<body>
  <h1>ðŸŽµ YouTube Downloader</h1>
  <p>Search for any song or paste a YouTube link below:</p>

  <input id="query" placeholder="e.g. Davido Feel or https://youtube.com/watch?v=..." style="width:100%" />
  <button onclick="search()">Search</button>

  <div id="results"></div>
  <hr />
  <div id="log"></div>

<script>
async function search(){
  const q = document.getElementById("query").value.trim();
  const results = document.getElementById("results");
  const log = document.getElementById("log");
  results.innerHTML = "Searching...";
  if (!q) return;

  // Detect if input is a full YouTube link
  if (q.includes("youtube.com/watch") || q.includes("youtu.be/")) {
    results.innerHTML = `<p>Direct link detected. <button onclick="download('${q}','mp4')">Download MP4</button> <button onclick="download('${q}','mp3')">Download MP3</button></p>`;
    return;
  }

  const res = await fetch("/search", {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({query:q})});
  const data = await res.json();
  if (!res.ok) { results.innerHTML = "Error: "+data.error; return;}
  results.innerHTML = "";

  if (data.length === 0){ results.innerHTML = "No results found."; return; }

  data.forEach(v=>{
    const div=document.createElement("div");
    div.className="result";
    div.innerHTML=`
      <img src="${v.thumbnail}" class="thumb">
      <div>
        <b>${v.title}</b><br>
        <small>${v.url}</small><br>
        <div class="actions">
          <button onclick="download('${v.url}','mp4')">MP4</button>
          <button onclick="download('${v.url}','mp3')">MP3</button>
        </div>
      </div>`;
    results.appendChild(div);
  });
}

async function download(url,format){
  const log=document.getElementById("log");
  log.innerHTML="Processing download...";
  const res = await fetch("/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url,format})});
  const data = await res.json();
  if(!res.ok){ log.innerHTML="Error: "+data.error; return;}
  log.innerHTML=`<a href="${data.file}" download="${data.name}">Click to download ${data.name}</a>`;
}
</script>
</body>
</html>
